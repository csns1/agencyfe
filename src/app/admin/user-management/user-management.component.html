<h1>Users<a (click)="createUserPopup()"><i class="pointer fa fa-user-plus" aria-hidden="true"></i></a> </h1>
<table class="table table-hover" cellspacing="0">
  <thead>
  <tr>
    <th>First Name</th>
    <th>Last Name</th>
    <th>Username</th>
    <th>Email</th>
    <th>Phone</th>
    <th>Address</th>
    <th>Role</th>
    <th>Operations</th>
  </tr>
  </thead>
  <tbody>
  <tr *ngFor="let user of users">
    <td>{{user.firstName}}</td>
    <td>{{user.lastName}}</td>
    <td>{{user.username}}</td>
    <td>{{user.email}}</td>
    <td>{{user.phone}}</td>
    <td>{{user.address}}</td>
    <td>{{user.role.name}}</td>
    <td>
      <div *ngIf="!(user.role.name==='ADMIN');else adminDiv" class="btn-group">
        <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#">
          <span class="fa fa-bars" title="Toggle dropdown menu"></span>
        </a>
        <ul class="dropdown-menu">
          <li><a class="btn" (click)="updateRole(user,updateRoleTemplate)"><i class="fa fa-pencil fa-fw"></i> Role</a></li>
          <li><a class="btn" (click)="delete(user,deleteTemplate)"><i class="fa fa-trash-o fa-fw"></i> Delete</a></li>
        </ul>
      </div>
      <ng-template  #adminDiv>
        <div class="btn-group">
        <a class="btn btn-primary dropdown-toggle disabled" data-toggle="dropdown" href="#">
          <span class="fa fa-bars" title="Toggle dropdown menu"></span>
        </a>
        </div>
      </ng-template>
    </td>
  </tr>
  </tbody>
</table>
<ng-template #deleteTemplate>
  <div class="modal-body text-center">
    <p>Do you want to confirm?</p>
    <button type="button" class="btn btn-default" (click)="confirmDelete()" >Yes</button>
    <button type="button" class="btn btn-primary" (click)="modalRef.hide()" >No</button>
  </div>
</ng-template>
<ng-template #updateCreateUser>
  <div class="row">
    <div class="col-md-4 col-md-offset-4">
      <div id="first">
        <div class="myform form ">
          <div class="logo mb-3">
            <div class="col-md-12 text-center">
            </div>
          </div>
          <form name="form" (ngSubmit)="f.form.valid && onSubmit()" #f="ngForm" novalidate>
            <div class="form-group">
              <label for="firstName">First Name</label>
              <input type="text" class="form-control" name="name" [(ngModel)]="newUser.firstName" #name="ngModel" required />
              <div *ngIf="f.submitted && name.invalid">
                <div *ngIf="name.errors.required">FirstName is required</div>
              </div>
            </div>
            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input type="text" class="form-control" name="name" [(ngModel)]="newUser.lastName" #name="ngModel" required />
              <div *ngIf="f.submitted && name.invalid">
                <div *ngIf="name.errors.required">LastName is required</div>
              </div>
            </div>
            <div class="form-group">
              <label for="username">Username</label>
              <input type="text" class="form-control" name="username" [(ngModel)]="newUser.username" #username="ngModel"
                     required />
              <div *ngIf="f.submitted && username.invalid">
                <div *ngIf="username.errors.required">Username is required</div>
              </div>
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="text" class="form-control" name="email" [(ngModel)]="newUser.email" #email="ngModel" required email />
              <div *ngIf="f.submitted && email.invalid">
                <div *ngIf="email.errors.required">Email is required</div>
                <div *ngIf="email.errors.email">Email must be a valid email address</div>
              </div>
            </div>
            <div class="form-group">
              <label for="password">Password</label>
              <input type="password" class="form-control" name="password" [(ngModel)]="newUser.password" #password="ngModel"
                     required minlength="6" />
              <div *ngIf="f.submitted && password.invalid">
                <div *ngIf="password.errors.required">Password is required</div>
                <div *ngIf="password.errors.minlength">Password must be at least 6 characters</div>
              </div>
            </div>
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input type="text" class="form-control" name="phone" [(ngModel)]="newUser.phone" #name="ngModel" required />
              <div *ngIf="f.submitted && name.invalid">
                <div *ngIf="name.errors.required">Name is required</div>
              </div>
            </div>

            <div class="form-group">
              <label for="address">Address</label>
              <input type="text" class="form-control" name="address" [(ngModel)]="newUser.address" #name="ngModel" required />
              <div *ngIf="f.submitted && name.invalid">
                <div *ngIf="name.errors.required">Name is required</div>
              </div>
            </div>
            <div class="form-group">
              <label for="role">Role</label>
              <select class="form-control form-control-sm" name="role" [(ngModel)]="newUser.role.name" #name="ngModel" >
                <option *ngFor="let role of roles" value="{{role.name}}">{{role.name}}</option>
              </select>
              <div *ngIf="f.submitted && name.invalid">
                <div *ngIf="name.errors.required">Role is required</div>
              </div>
            </div>
            <div class="form-group">
              <button class="btn btn-primary">Create New User</button>
              <div *ngIf="f.submitted && isSignUpFailed" class="alert alert-warning">
                Creating new user failed!<br/>{{errorMessage}}
              </div>
            </div>
          </form>

        </div>
      </div></div></div>
</ng-template>
<ng-template #updateRoleTemplate>
  <div class="row">
    <div class="col-md-4 col-md-offset-4">
      <div id="first">
        <div class="myform form ">
          <div class="logo mb-3">
            <div class="col-md-12 text-center">
            </div>
          </div>
          <form name="form" (ngSubmit)="f.form.valid && editRole()" #f="ngForm" novalidate>
            <div class="form-group">
              <label for="role">Role</label>
              <select class="form-control form-control-sm" name="role" [(ngModel)]="newRole" #name="ngModel" >
                <option *ngFor="let role of roles" value="{{role.name}}">{{role.name}}</option>
              </select>
            </div>
            <div class="form-group">
              <button class="btn btn-primary">Change Role</button>
            </div>
          </form>

        </div>
      </div></div></div>
</ng-template>
